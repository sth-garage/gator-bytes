<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gator Bytes – Chat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700;800&display=swap"
          rel="stylesheet">

    <style>
        /* Global palette ------------------------------------------------------- */
        :root {
            --gb-blue-800: #63B3ED;
            --gb-blue-700: #4591E2;
            --gb-purple-800: #8F5D9C;
            --gb-dark-purple: #362730;
            --gb-pink: #E164A7;
            --gb-bg: #fefae0;
            --gb-surface: rgba(255,255,255,.96);
            --gb-border: rgba(40,54,24,.18);
            --gb-text: #1c1f13;
            --gb-muted: #6b705c;
            --app-shell-gradient: linear-gradient(135deg,#63B3ED 0%,#4591E2 30%, #8F5D9C 70%,#E164A7 100%);
            --header-gradient: linear-gradient(96deg,#63B3ED 0%,#4591E2 36%, #8F5D9C 100%);
            --shadow-1: 0 10px 28px rgba(54,39,48,.10);
            --shadow-2: 0 18px 50px rgba(54,39,48,.16);
        }
        /* Layout --------------------------------------------------------------- */
        html, body {
            height: 100%;
            margin: 0;
            font-family: "Barlow",sans-serif;
            color: #000;
            background: var(--app-shell-gradient);
            overflow: hidden;
        }

        .main-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .app-content {
            width: 90%;
            height: 95%;
            padding: 24px 28px 28px 28px;
            display: flex;
        }

        .chat-pane {
            flex: 1 1 auto;
            background: var(--gb-surface);
            border: 1px solid var(--gb-border);
            border-radius: 18px;
            box-shadow: var(--shadow-2);
            display: flex;
            flex-direction: column;
        }

        .pane-header-bar {
            padding: 14px 18px;
            border-bottom: 1px solid var(--gb-border);
            background: linear-gradient(90deg,#4591E2 .14,#E164A7 .18);
        }

        .pane-title {
            display: flex;
            align-items: center;
            font-weight: 800;
            color: #63B3ED;
        }

            .pane-title .avatar {
                width: 38px;
                height: 38px;
                border-radius: 50%;
                background: linear-gradient(135deg,#63B3ED,#8F5D9C);
                display: inline-flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 3px 8px rgba(54,39,48,.18);
                overflow: hidden;
                border: 2.5px solid #fefae0;
            }

                .pane-title .avatar img {
                    width: 100%;
                    height: 100%;
                    object-fit: contain
                }

        .chat-messages-area {
            flex: 1 1 auto;
            margin: 14px;
            border-radius: 14px;
            border: 1px solid var(--gb-border);
            background: #fff;
            padding: 16px 12px;
            overflow-y: auto;
            min-height: 200px;
        }

        .chat-input-row {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 14px;
            border-top: 1px solid var(--gb-border);
            background: #ECECEC
        }

        #sendMessage {
            flex: 1;
            border-radius: 12px;
            background: rgba(254,250,224,.95);
            border: 1px solid var(--gb-border);
            padding: 12px 14px;
            font-size: 1.05rem;
        }

        #sendButton {
            background: linear-gradient(180deg,#E164A7,#8F5D9C);
            color: #fff;
            border-radius: 12px;
            padding: .62em 1.4em;
            border: 1px solid rgba(0,0,0,.05);
            box-shadow: 0 10px 22px rgba(225,100,167,.35);
        }

            #sendButton:disabled {
                background: rgba(225,100,167,.35);
                color: rgba(54,39,48,.8);
                box-shadow: none;
                border-color: rgba(225,100,167,.55)
            }
        /* Chat message ---------------------------------------------------------- */
        .chat-message {
            display: flex;
            margin: 10px 8px;
            gap: 8px;
            align-items: flex-end;
        }

            .chat-message[data-role="Client"] {
                justify-content: flex-end
            }

            .chat-message[data-role="Assistant"], .chat-message[data-role="System"] {
                justify-content: flex-start
            }

        .chat-bubble {
            position: relative;
            padding: 12px 14px 22px;
            border-radius: 14px;
            border: 1.5px solid var(--gb-border);
            background: #fff;
            color: var(--gb-text);
            box-shadow: 0 2px 12px rgba(0,0,0,.05);
        }

        .chat-message[data-role="Client"] .chat-bubble {
            background: rgba(69,145,226,.12);
            border-color: rgba(69,145,226,.55)
        }

        .chat-message[data-role="Assistant"] .chat-bubble {
            background: rgba(143,93,156,.10);
            border-color: rgba(143,93,156,.55)
        }
        /* Hide unused parts ---------------------------------------------- */
        .gb-header {
            display: none
        }

        .header-underline {
            display: none
        }

        .top-banner {
            display: none
        }

        .visually-hidden {
            position: absolute !important;
            height: 1px;
            width: 1px;
            overflow: hidden;
            clip: rect(1px,1px,1px,1px);
            white-space: nowrap;
            border: 0;
            padding: 0;
        }
        /* Modal styles are removed – no modals in this version */
    </style>
</head>

<body>
    <div class="main-container">
        <div class="app-content">
            <section class="chat-pane shadow" id="chatPane" role="main"
                     aria-label="Gator Bytes chat">
                <!-- Header -->
                <div class="pane-header-bar">
                    <div class="pane-title">
                        <span class="avatar" title="Semantigator avatar">
                            <img src="Images/chat.png" alt="Semantigator avatar"
                                 onerror="this.style.display='none'" />
                        </span>
                        <span>Chat with Semantigator</span>
                    </div>
                </div>

                <!-- Messages area -->
                <div class="chat-messages-area" id="chatArea" tabindex="0"
                     aria-label="Chat messages">
                    <div class="welcome-message text-center">
                        <h1>Welcome to <span class="hopeful-gradient">Gator Bytes</span></h1>
                        <p>Find your perfect job match with our smart assistant, Semantigator.</p>
                    </div>
                </div>

                <!-- Input row -->
                <div class="chat-input-row">
                    <input type="text" id="sendMessage" class="form-control"
                           placeholder="Paste a job description, résumé, or question here…"
                           aria-label="Message to send" autocomplete="off" disabled />
                    <button id="sendButton" class="btn" type="button" disabled>Send</button>
                </div>
            </section>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
// ---------------------- WebSocket & Chat Logic -----------------------
$(function () {
  const $chatArea = $('#chatArea');
  const $sendMessage = $('#sendMessage');
  const $sendButton = $('#sendButton');

  let socket;
  const wsUrl = (location.protocol === "https:" ? "wss://" : "ws://") +
                location.hostname + (location.port ? (":" + location.port) : "") + "/ws";

  // Enable/disable inputs
  function enableInputs(state=true){ $sendMessage.prop('disabled', !state);
    $sendButton.prop('disabled', !state || $sendMessage.val().trim()==="");}
  function disableInputs(){enableInputs(false);}

  // Build message element
  function addMessage(msgObj, isOwn=false, latencySec=null){
    const role = msgObj?.Role?.Label || (isOwn ? "Client" : "Assistant");
    let text = "";
    if (msgObj.Items && msgObj.Items[0]?.Text) text = msgObj.Items[0].Text;
    else if (msgObj.Text) text = msgObj.Text;
    else if (typeof msgObj === 'string') text = msgObj;
    else text = $('<div/>').text(JSON.stringify(msgObj)).html();

    const $msgEl = $('<div>').addClass('chat-message')
      .attr('data-role', role).attr('tabindex',0)
      .data('chatMessage', msgObj);
    const $bubble = $('<div>').addClass('chat-bubble').html(text);

    $msgEl.append($bubble);
    $chatArea.append($msgEl);

    // Scroll to bottom
    if (role !== "Client") {
      $chatArea[0].scrollTop = $chatArea[0].scrollHeight;
    }
    return $msgEl;
  }

  // Connect WebSocket
  function connectSocket(){
    socket = new WebSocket(wsUrl);
    socket.onopen=function(){enableInputs(true);socket.send('Introduce yourself');};
    socket.onclose=function(){disableInputs();addMessage({Role:{Label:"System"},
      Items:[{Text:"<em>Connection closed.</em>"}],});}
    socket.onerror=function(){disableInputs();
      addMessage({Role:{Label:"System"},Items:[{Text:"<em>A connection error occurred.</em>"}]});}
    socket.onmessage=function(e){
      const data=e.data;
      let obj=null;
      try{obj=JSON.parse(data);}catch{obj={Role:{Label:"Assistant"},
        Items:[{Text:data}]};}
      addMessage(obj,false);
      enableInputs(true);
    };
  }
  connectSocket();

  // Send message
  function sendCurrent(){
    if(!socket||socket.readyState!==WebSocket.OPEN)return;
    const text=$sendMessage.val();
    if(!text.trim())return;
    addMessage({Role:{Label:"Client"},Items:[{Text: $('<div/>').text(text).html()}]});
    socket.send(text);
    $sendMessage.val('').focus();
  }

  $sendButton.on('click', sendCurrent);
  $sendMessage.on('keydown', e=>{
    if(e.key==='Enter'){e.preventDefault();sendCurrent();}
    // Arrow history removed – no extra logic
  });

  $sendMessage.on('input',()=>{
    $sendButton.prop('disabled',$sendMessage.val().trim()===''||socket.readyState!==WebSocket.OPEN);
  });
});
    </script>
</body>
</html>
